
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Artificial Intelligence for Advanced Open Environmental Science">
      
      
        <link rel="canonical" href="https://jacobmontiel.github.io/Notebooks/Moana-thredds-server-connector/">
      
      
        <meta name="author" content="The taiao developers">
      
      <link rel="shortcut icon" href="../../img/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.0">
    
    
      
        <title>Moana thredds server connector - Taiao</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bc7e593a.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab28b872.min.css">
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../css/version-select.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="indigo">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#moana-thredds-server-connector" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://jacobmontiel.github.io" title="Taiao" class="md-header-nav__button md-logo" aria-label="Taiao">
      
  <img src="../../img/Untitled.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Taiao
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Moana thredds server connector
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/jacobmontiel/taiao-docs" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    taiao-docs
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../About-Us/Taiao/" class="md-tabs__link">
          About Us
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Datasets/Aggregated-wave-and-atmospheric-forecast/" class="md-tabs__link">
          Datasets
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../critter-detector/" class="md-tabs__link md-tabs__link--active">
          Notebooks
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Software/River/" class="md-tabs__link">
          Software
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Tutorials/Notebooks-Python/" class="md-tabs__link">
          Tutorials
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../Discuss/forum/" class="md-tabs__link">
          Discuss
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://jacobmontiel.github.io" title="Taiao" class="md-nav__button md-logo" aria-label="Taiao">
      
  <img src="../../img/Untitled.png" alt="logo">

    </a>
    Taiao
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/jacobmontiel/taiao-docs" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    taiao-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      About Us
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="About Us" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        About Us
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../About-Us/Taiao/" class="md-nav__link">
      Taiao
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../About-Us/Our-Team/" class="md-nav__link">
      Our Team
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Get-Involved.md" class="md-nav__link">
      Get Involved
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Datasets
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Datasets" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Datasets
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Datasets/Aggregated-wave-and-atmospheric-forecast/" class="md-nav__link">
      Aggregated wave and atmospheric forecast
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Datasets/Auckland-hamilton-aerial-photography/" class="md-nav__link">
      Auckland/Hamilton aerial photography
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Datasets/Water-quality-discharge-BOP/" class="md-nav__link">
      Bay of Plenty Regional Council Water Quality and Discharge data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Datasets/Blitzen-lightning-feed/" class="md-nav__link">
      Blitzen lightning feed
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Datasets/Coromandel-River-Rain-gauge/" class="md-nav__link">
      Coromandel River & Rain gauge
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Datasets/Critter-detector/" class="md-nav__link">
      Critter Detector
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Datasets/Global-topography/" class="md-nav__link">
      Global Topography
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Datasets/Google-earth-geospatial-data-sets/" class="md-nav__link">
      Google Earth Data Catalog
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Datasets/GPATS-Oceania-lightning/" class="md-nav__link">
      GPATS Oceania lightning feed
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Datasets/Himawari-8-weather-satellite/" class="md-nav__link">
      Himawari 8 Weather Satellite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Datasets/Images-of-wildlife-from-cameras/" class="md-nav__link">
      Images of wildlife from cameras
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Datasets/Landsat-8-remote-sensing/" class="md-nav__link">
      Landsat 8 - Remote sensing data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Datasets/LILA-Wellington-Camera-Trap/" class="md-nav__link">
      LILA Wellington Camera Trap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Datasets/Metocean-wave-buoy/" class="md-nav__link">
      MetOcean wave buoys (Campbell Island & Southern Ocean)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Datasets/Automatic-Weather-stations/" class="md-nav__link">
      MetService automatic weather stations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Datasets/Moana-hydrodynamic-hindcast/" class="md-nav__link">
      Moana 25 year hydrodynamic hindcast of New Zealand waters
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Datasets/NZ-Radar-dataset/" class="md-nav__link">
      NZ MetServices Rain Radar network
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Datasets/Sentinel-Satellite-snapshot-of-Waikato-region/" class="md-nav__link">
      Sentinel Satellite snapshot of Waikato region
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Datasets/TAO-lightening-feed/" class="md-nav__link">
      TAO lightening feed
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Datasets/Tropical-Cyclone-archive/" class="md-nav__link">
      Tropical Cyclone archive
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Notebooks
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Notebooks" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Notebooks
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../critter-detector/" class="md-nav__link">
      Critter Detector
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Himawari8/" class="md-nav__link">
      Himawari8 AWS data connector
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../metocean-obs-api-connector/" class="md-nav__link">
      MetOcean Solutions API
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Moana thredds server connector
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Moana thredds server connector
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#github-repository" class="md-nav__link">
    GitHub repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datasets" class="md-nav__link">
    Datasets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#author" class="md-nav__link">
    Author
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#license" class="md-nav__link">
    License
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#technologies" class="md-nav__link">
    Technologies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tags" class="md-nav__link">
    Tags
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-description" class="md-nav__link">
    Data description
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-description" class="md-nav__link">
    Connector description
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector" class="md-nav__link">
    Connector
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-usage-of-connector" class="md-nav__link">
    Example usage of connector
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../NZ-Radar-connector/" class="md-nav__link">
      NZ MetServices rain radar network
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../TAIAO-UseCase-4/" class="md-nav__link">
      Taiao Case 4
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Moana thredds server connector
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Moana thredds server connector
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#github-repository" class="md-nav__link">
    GitHub repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datasets" class="md-nav__link">
    Datasets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#author" class="md-nav__link">
    Author
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#license" class="md-nav__link">
    License
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#technologies" class="md-nav__link">
    Technologies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tags" class="md-nav__link">
    Tags
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-description" class="md-nav__link">
    Data description
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-description" class="md-nav__link">
    Connector description
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector" class="md-nav__link">
    Connector
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-usage-of-connector" class="md-nav__link">
    Example usage of connector
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Software
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Software" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Software
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Software/River/" class="md-nav__link">
      River
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Software/Explainable-Ai/" class="md-nav__link">
      Explainable AI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Software/Weka/" class="md-nav__link">
      Weka
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Software/Moa/" class="md-nav__link">
      Moa
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Software/Adams/" class="md-nav__link">
      Adams
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Tutorials
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Tutorials/Notebooks-Python/" class="md-nav__link">
      Notebooks & Python an Introduction
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Discuss
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Discuss" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        Discuss
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Discuss/forum/" class="md-nav__link">
      Forum
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#github-repository" class="md-nav__link">
    GitHub repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datasets" class="md-nav__link">
    Datasets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#author" class="md-nav__link">
    Author
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#license" class="md-nav__link">
    License
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#technologies" class="md-nav__link">
    Technologies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tags" class="md-nav__link">
    Tags
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-description" class="md-nav__link">
    Data description
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-description" class="md-nav__link">
    Connector description
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector" class="md-nav__link">
    Connector
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-usage-of-connector" class="md-nav__link">
    Example usage of connector
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="moana-thredds-server-connector">Moana thredds server connector<a class="headerlink" href="#moana-thredds-server-connector" title="Permanent link">&para;</a></h1>
<p><a href="https://colab.research.google.com/github/jacobmontiel/taiao-docs/blob/main/docs/Notebooks/Moana-thredds-server-connector.ipynb">Run in Google Colab</a></p>
<h4 id="github-repository">GitHub repository<a class="headerlink" href="#github-repository" title="Permanent link">&para;</a></h4>
<p>GitHub repository is located <a href="https://github.com/metocean/TAIAO/blob/master/data_connectors/moana_connectors/Moana%20thredds%20server%20connector.ipynb">here</a>.</p>
<h4 id="datasets">Datasets<a class="headerlink" href="#datasets" title="Permanent link">&para;</a></h4>
<p>Please see the <a href="../../Datasets/Moana-hydrodynamic-hindcast/">Datasets page</a> for further details.</p>
<h4 id="author">Author<a class="headerlink" href="#author" title="Permanent link">&para;</a></h4>
<p>Sebastien Delaux</p>
<h4 id="license">License<a class="headerlink" href="#license" title="Permanent link">&para;</a></h4>
<p>N/A</p>
<h4 id="technologies">Technologies<a class="headerlink" href="#technologies" title="Permanent link">&para;</a></h4>
<p>N/A</p>
<h4 id="tags">Tags<a class="headerlink" href="#tags" title="Permanent link">&para;</a></h4>
<p>Model, Hindcast, Sea, Current, SST
<br>
<br>
<br>
Author: Sebastien Delaux</p>
<p>This notebook describes how to get observation data from the thredds server set on top of the Moana 25 year hydrodynamic hindcast of New Zealand waters. The data is freely available from that server under the terms of the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License (see https://www.moanaproject.org/data for more).</p>
<h2 id="data-description">Data description<a class="headerlink" href="#data-description" title="Permanent link">&para;</a></h2>
<p>The Moana backbone hindcast datasets comes in the form of 4 sources of data stored in 4 subfolders on the thredds server (http://thredds.moanaproject.org:8080/thredds/catalog/moana/ocean/NZB/v1.9/catalog.xml):</p>
<ul>
<li>
<p><strong>raw_3D</strong>: This folder contains the raw ROMS outputs (3D and 2D fields). All the fields are laid on their original curvilinear grids. Main variables are:</p>
<ul>
<li>Free-surface height (zeta) in metres</li>
<li>Eastward vertically integrated momentum component (ubar_eastward) in metres per second</li>
<li>Northward vertically integrated momentum component (vbar_eastward) in metres per second</li>
<li>Eastward momentum component (u_eastward) in metres per second</li>
<li>Northward momentum component (v_eastward) in metres per second</li>
<li>Potential temperature (temp) in degrees Celcius</li>
<li>Salinity (salt)</li>
</ul>
</li>
</ul>
<p><em>cat_url</em> = 'http://thredds.moanaproject.org:8080/thredds/catalog/moana/ocean/NZB/v1.9/raw_3D/catalog.xml' <br>
  <em>base_dods_url</em> = 'http://thredds.moanaproject.org:8080/thredds/dodsC/moana/ocean/NZB/v1.9/raw_3D/' <br></p>
<ul>
<li><strong>monthly_avg</strong>: This folder contains monthly averages of the raw ROMS outputs (3D and 2D fields). Main variables are:<ul>
<li>Time-averaged free-surface height (zeta) in metres</li>
<li>Time-averaged eastward vertically integrated momentum component (ubar_eastward) in metres per second</li>
<li>Time-averaged northward vertically integrated momentum component (vbar_eastward) in metres per second</li>
<li>Time-averaged eastward momentum component (u_eastward) in metres per second</li>
<li>Time-averaged northward momentum component (v_eastward) in metres per second</li>
<li>Time-averaged potential temperature (temp) in degrees Celcius</li>
<li>Time-averaged salinity (salt)</li>
</ul>
</li>
</ul>
<p><em>cat_url</em> = 'http://thredds.moanaproject.org:8080/thredds/catalog/moana/ocean/NZB/v1.9/monthly_avg/catalog.xml' <br>
  <em>base_dods_url</em> = 'http://thredds.moanaproject.org:8080/thredds/dodsC/moana/ocean/NZB/v1.9/monthly_avg/' <br></p>
<ul>
<li><strong>processed_sfc</strong>: This folder contains 2D variables only (surface, depth-averaged, bathymetry) interpolated to a rectilinear longitude/latitude grid. Main variables are:<ul>
<li>Sea surface height above geoid (ssh) in metres</li>
<li>Sea surface temperature (sst) in degrees Celcius</li>
<li>Surface Eastward sea water velocity (us) in metres per second</li>
<li>Surface Northward sea water velocity (vs) in metres per second</li>
<li>Depth-averaged Eastward sea water velocity (um) in metres per second</li>
<li>Depth-averaged Northward sea water velocity (vm) in metres per second</li>
<li>Sea floor depth below mean sea level (dep) in metres</li>
</ul>
</li>
</ul>
<p><em>cat_url</em> = http://thredds.moanaproject.org:8080/thredds/catalog/moana/ocean/NZB/v1.9/processed_sfc/catalog.xml' <br>
  <em>base_dods_url</em> = 'http://thredds.moanaproject.org:8080/thredds/dodsC/moana/ocean/NZB/v1.9/processed_sfc/' <br></p>
<ul>
<li><strong>processed_3D</strong>: This folder contains the 3D fields interpolated on a rectilinear longitude/latitude/level 3D grids. Main variables are:<ul>
<li>Sea water temperature (temp) in degrees Celcius</li>
<li>Sea water absolute salinity (salt) in 1e-3</li>
<li>Eastward sea water velocity (u) in metres per second</li>
<li>Northward sea water velocity (v) in meters per second</li>
</ul>
</li>
</ul>
<p><em>cat_url</em> = 'http://thredds.moanaproject.org:8080/thredds/catalog/moana/ocean/NZB/v1.9/processed_3D/catalog.xml' <br>
  <em>base_dods_url</em> = 'http://thredds.moanaproject.org:8080/thredds/dodsC/moana/ocean/NZB/v1.9/processed_3D/' <br></p>
<h2 id="connector-description">Connector description<a class="headerlink" href="#connector-description" title="Permanent link">&para;</a></h2>
<p>For now the connector provides only a way to load the data under the shape of an xarray dataset.</p>
<p>The motivation being using xarray are the following:
- xarray is a popular python library that allow to work with NetCDF files stored on drive or on openDap servers
- xarray is built on top of dask which allow a number of operations, in particular sub-sampling, to be done in lazy mode (data don't get loaded until really needed)
- xarray is highly compatible with the numpy library
- xarray offers a number of useful export/plotting functions</p>
<h2 id="connector">Connector<a class="headerlink" href="#connector" title="Permanent link">&para;</a></h2>
<p>First we install xarray which we will use to handle the data and siphon which we will use to talk with the thredds server catalog. Also we install matplotlib to generate plots later on.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="err">!</span><span class="p">{</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">}</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">xarray</span> <span class="n">siphon</span> <span class="n">matplotlib</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Collecting xarray
  Downloading https://files.pythonhosted.org/packages/ee/11/fb2a8a6015e3de4ff19a4870bb0d11f48ebdd997062557d24cd076b3088f/xarray-0.15.1-py3-none-any.whl (668kB)
[K    100% |████████████████████████████████| 675kB 1.2MB/s ta 0:00:01
[?25hCollecting siphon
  Using cached https://files.pythonhosted.org/packages/56/f5/2be03af9ac2911d4795ac69de86dbd1b48c404a7812a4bf1b00403eafda5/siphon-0.8.0-py2.py3-none-any.whl
Collecting matplotlib
  Using cached https://files.pythonhosted.org/packages/93/4b/52da6b1523d5139d04e02d9e26ceda6146b48f2a4e5d2abfdf1c7bac8c40/matplotlib-3.2.1-cp36-cp36m-manylinux1_x86_64.whl
Collecting numpy&gt;=1.15 (from xarray)
  Using cached https://files.pythonhosted.org/packages/07/08/a549ba8b061005bb629b76adc000f3caaaf881028b963c2e18f811c6edc1/numpy-1.18.2-cp36-cp36m-manylinux1_x86_64.whl
Collecting setuptools&gt;=41.2 (from xarray)
  Using cached https://files.pythonhosted.org/packages/a0/df/635cdb901ee4a8a42ec68e480c49f85f4c59e8816effbf57d9e6ee8b3588/setuptools-46.1.3-py3-none-any.whl
Collecting pandas&gt;=0.25 (from xarray)
  Downloading https://files.pythonhosted.org/packages/bb/71/8f53bdbcbc67c912b888b40def255767e475402e9df64050019149b1a943/pandas-1.0.3-cp36-cp36m-manylinux1_x86_64.whl (10.0MB)
[K    100% |████████████████████████████████| 10.0MB 175kB/s ta 0:00:01
[?25hCollecting requests&gt;=1.2 (from siphon)
  Using cached https://files.pythonhosted.org/packages/1a/70/1935c770cb3be6e3a8b78ced23d7e0f3b187f5cbfab4749523ed65d7c9b1/requests-2.23.0-py2.py3-none-any.whl
Collecting beautifulsoup4&gt;=4.6 (from siphon)
  Using cached https://files.pythonhosted.org/packages/cb/a1/c698cf319e9cfed6b17376281bd0efc6bfc8465698f54170ef60a485ab5d/beautifulsoup4-4.8.2-py3-none-any.whl
Collecting protobuf&gt;=3.0.0a3 (from siphon)
  Using cached https://files.pythonhosted.org/packages/57/02/5432412c162989260fab61fa65e0a490c1872739eb91a659896e4d554b26/protobuf-3.11.3-cp36-cp36m-manylinux1_x86_64.whl
Collecting python-dateutil&gt;=2.1 (from matplotlib)
  Using cached https://files.pythonhosted.org/packages/d4/70/d60450c3dd48ef87586924207ae8907090de0b306af2bce5d134d78615cb/python_dateutil-2.8.1-py2.py3-none-any.whl
Collecting pyparsing!=2.0.4,!=2.1.2,!=2.1.6,&gt;=2.0.1 (from matplotlib)
  Using cached https://files.pythonhosted.org/packages/5d/bc/1e58593167fade7b544bfe9502a26dc860940a79ab306e651e7f13be68c2/pyparsing-2.4.6-py2.py3-none-any.whl
Collecting cycler&gt;=0.10 (from matplotlib)
  Using cached https://files.pythonhosted.org/packages/f7/d2/e07d3ebb2bd7af696440ce7e754c59dd546ffe1bbe732c8ab68b9c834e61/cycler-0.10.0-py2.py3-none-any.whl
Collecting kiwisolver&gt;=1.0.1 (from matplotlib)
  Using cached https://files.pythonhosted.org/packages/f8/a1/5742b56282449b1c0968197f63eae486eca2c35dcd334bab75ad524e0de1/kiwisolver-1.1.0-cp36-cp36m-manylinux1_x86_64.whl
Collecting pytz&gt;=2017.2 (from pandas&gt;=0.25-&gt;xarray)
  Using cached https://files.pythonhosted.org/packages/e7/f9/f0b53f88060247251bf481fa6ea62cd0d25bf1b11a87888e53ce5b7c8ad2/pytz-2019.3-py2.py3-none-any.whl
Collecting chardet&lt;4,&gt;=3.0.2 (from requests&gt;=1.2-&gt;siphon)
  Using cached https://files.pythonhosted.org/packages/bc/a9/01ffebfb562e4274b6487b4bb1ddec7ca55ec7510b22e4c51f14098443b8/chardet-3.0.4-py2.py3-none-any.whl
Collecting certifi&gt;=2017.4.17 (from requests&gt;=1.2-&gt;siphon)
  Using cached https://files.pythonhosted.org/packages/b9/63/df50cac98ea0d5b006c55a399c3bf1db9da7b5a24de7890bc9cfd5dd9e99/certifi-2019.11.28-py2.py3-none-any.whl
Collecting urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1 (from requests&gt;=1.2-&gt;siphon)
  Using cached https://files.pythonhosted.org/packages/e8/74/6e4f91745020f967d09332bb2b8b9b10090957334692eb88ea4afe91b77f/urllib3-1.25.8-py2.py3-none-any.whl
Collecting idna&lt;3,&gt;=2.5 (from requests&gt;=1.2-&gt;siphon)
  Using cached https://files.pythonhosted.org/packages/89/e3/afebe61c546d18fb1709a61bee788254b40e736cff7271c7de5de2dc4128/idna-2.9-py2.py3-none-any.whl
Collecting soupsieve&gt;=1.2 (from beautifulsoup4&gt;=4.6-&gt;siphon)
  Using cached https://files.pythonhosted.org/packages/05/cf/ea245e52f55823f19992447b008bcbb7f78efc5960d77f6c34b5b45b36dd/soupsieve-2.0-py2.py3-none-any.whl
Collecting six&gt;=1.9 (from protobuf&gt;=3.0.0a3-&gt;siphon)
  Using cached https://files.pythonhosted.org/packages/65/eb/1f97cb97bfc2390a276969c6fae16075da282f5058082d4cb10c6c5c1dba/six-1.14.0-py2.py3-none-any.whl
Installing collected packages: numpy, setuptools, pytz, six, python-dateutil, pandas, xarray, chardet, certifi, urllib3, idna, requests, soupsieve, beautifulsoup4, protobuf, siphon, pyparsing, cycler, kiwisolver, matplotlib
Successfully installed beautifulsoup4-4.8.2 certifi-2019.11.28 chardet-3.0.4 cycler-0.10.0 idna-2.9 kiwisolver-1.1.0 matplotlib-3.2.1 numpy-1.18.2 pandas-1.0.3 protobuf-3.11.3 pyparsing-2.4.6 python-dateutil-2.8.1 pytz-2019.3 requests-2.23.0 setuptools-46.1.3 siphon-0.8.0 six-1.14.0 soupsieve-2.0 urllib3-1.25.8 xarray-0.15.1
</code></pre></div>

<p>Now we load xarray and siphon</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">from</span> <span class="nn">siphon.catalog</span> <span class="kn">import</span> <span class="n">TDSCatalog</span>
</code></pre></div>

<p>Then we load a couple of reasonably standard python library</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">dateutil.relativedelta</span> <span class="kn">import</span> <span class="n">relativedelta</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">re</span>
</code></pre></div>

<p>We define a couple of methods helping to identify whether a filename contains data relevant to a given time range. Those allow to avoid loading unnecessary metadata.</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">datetime_from_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse a moana filename and return the datetime corresponding</span>
<span class="sd">        to the first timestamp in the monthly file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            The name of one of the Moana netCDF files from the thredds server.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        datetime</span>
<span class="sd">            A datetime object corresponding to the first timestamp in the file</span>

<span class="sd">        &quot;&quot;&quot;</span>
    <span class="n">datestring</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;(20\d</span><span class="si">{2}</span><span class="s1">\d</span><span class="si">{2}</span><span class="s1">|19\d</span><span class="si">{2}</span><span class="s1">\d</span><span class="si">{2}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">datestring</span><span class="p">,</span> <span class="s1">&#39;%Y%m&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">monthly_file_in_interval</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check whether a monthly Moana file contains data relevant to the time</span>
<span class="sd">        range [t1:t2]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            The name of one of the Moana netCDF files from the thredds server.</span>

<span class="sd">        t1 : datetime</span>
<span class="sd">            The start of the time range (None for an open interval). The start</span>
<span class="sd">            datetime is inclusive</span>

<span class="sd">        t2 : datetime</span>
<span class="sd">            The end of the time range (None for an open interval). The end</span>
<span class="sd">            datetime is exclusive</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        boolean</span>
<span class="sd">            Whether the file data relevant to the time range [t1:t2]</span>

<span class="sd">        &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tmin</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">tmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="n">t1</span> <span class="o">=</span> <span class="n">datetime_from_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">t1</span> <span class="o">&lt;</span> <span class="n">tmax</span>

    <span class="k">if</span> <span class="n">tmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tmin</span> <span class="o">&lt;</span> <span class="n">t1</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">t1</span> <span class="o">&lt;</span> <span class="n">tmax</span> <span class="ow">and</span> <span class="n">tmin</span> <span class="o">&lt;</span> <span class="n">t1</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<p>We define the connector</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">MoanaThreddsServerConnector</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class used to connect one the thredds server put</span>
<span class="sd">    on top of the Moana hydrodynamic hindcast of New Zealand waters</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    catalog_url : str</span>
<span class="sd">        The url to use to interogate the data catalog</span>
<span class="sd">    dods_base_url : str</span>
<span class="sd">        The base url to use to access the data via OpenDAP</span>
<span class="sd">    tmin : datetime</span>
<span class="sd">        The lower end of the time range for which data are required (inclusive).</span>
<span class="sd">        None means an open ended interval</span>
<span class="sd">    tmax : datetime</span>
<span class="sd">        The upper end of the time range for which data are required (exclusive).</span>
<span class="sd">        None means an open ended interval</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    get_xarray_dataset()</span>
<span class="sd">        return a xarray dataset object that allows efficient access/subsampling</span>
<span class="sd">        of the data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">catalog_url</span><span class="o">=</span><span class="s1">&#39;http://thredds.moanaproject.org:8080/thredds/catalog/moana/ocean/NZB/v1.9/monthly_avg/catalog.xml&#39;</span><span class="p">,</span>
                 <span class="n">dods_base_url</span><span class="o">=</span><span class="s1">&#39;http://thredds.moanaproject.org:8080/thredds/dodsC/moana/ocean/NZB/v1.9/monthly_avg/&#39;</span><span class="p">,</span>
                 <span class="n">tmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">tmax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>


        <span class="c1"># Store the urls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">catalog_url</span> <span class="o">=</span> <span class="n">catalog_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dods_base_url</span> <span class="o">=</span> <span class="n">dods_base_url</span>

        <span class="c1"># Get catalog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span> <span class="o">=</span> <span class="n">TDSCatalog</span><span class="p">(</span><span class="n">catalog_url</span><span class="p">)</span>

        <span class="c1"># Build list of all available files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dods_url</span> <span class="o">=</span> <span class="p">[</span><span class="n">dods_base_url</span><span class="o">+</span><span class="n">filename</span>\
                         <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">datasets</span><span class="p">)</span>
                         <span class="k">if</span> <span class="n">monthly_file_in_interval</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=</span><span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="n">tmax</span><span class="p">)]</span>

        <span class="c1"># Load base dataset object</span>
        <span class="k">if</span> <span class="s1">&#39;processed&#39;</span> <span class="ow">in</span> <span class="n">catalog_url</span><span class="p">:</span>
            <span class="n">concat_dim</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">concat_dim</span> <span class="o">=</span> <span class="s1">&#39;ocean_time&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dset</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dods_url</span><span class="p">,</span>
                                      <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                      <span class="n">coords</span><span class="o">=</span><span class="s2">&quot;minimal&quot;</span><span class="p">,</span>
                                      <span class="n">data_vars</span><span class="o">=</span><span class="s2">&quot;minimal&quot;</span><span class="p">,</span>
                                      <span class="n">compat</span><span class="o">=</span><span class="s1">&#39;override&#39;</span><span class="p">,</span>
                                      <span class="n">combine</span><span class="o">=</span><span class="s1">&#39;nested&#39;</span><span class="p">,</span>
                                      <span class="n">concat_dim</span><span class="o">=</span><span class="n">concat_dim</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_xarray_dset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dset</span>
</code></pre></div>

<h2 id="example-usage-of-connector">Example usage of connector<a class="headerlink" href="#example-usage-of-connector" title="Permanent link">&para;</a></h2>
<p>Initialise the connector</p>
<div class="codehilite"><pre><span></span><code><span class="n">cat_url</span> <span class="o">=</span> <span class="s2">&quot;http://thredds.moanaproject.org:8080/thredds/catalog/moana/ocean/NZB/v1.9/monthly_avg/catalog.xml&quot;</span>
<span class="n">base_dods_url</span> <span class="o">=</span> <span class="s1">&#39;http://thredds.moanaproject.org:8080/thredds/dodsC/moana/ocean/NZB/v1.9/monthly_avg/&#39;</span>

<span class="n">connector</span> <span class="o">=</span> <span class="n">MoanaThreddsServerConnector</span><span class="p">(</span><span class="n">cat_url</span><span class="p">,</span> <span class="n">base_dods_url</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">tmax</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</code></pre></div>

<p>For now get the full xarray dataset object</p>
<div class="codehilite"><pre><span></span><code><span class="n">dset</span> <span class="o">=</span> <span class="n">connector</span><span class="o">.</span><span class="n">get_xarray_dset</span><span class="p">()</span>
</code></pre></div>

<p>Find the names of all the variables in the datasets that are time dependent</p>
<div class="codehilite"><pre><span></span><code><span class="k">for</span> <span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dset</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="s1">&#39;ocean_time&#39;</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">dims</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="s1">&#39;--&gt;&#39;</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">],</span><span class="n">var</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>zeta --&gt; time-averaged free-surface (&#39;ocean_time&#39;, &#39;eta_rho&#39;, &#39;xi_rho&#39;)
ubar_eastward --&gt; time-averaged eastward vertically integrated momentum component at RHO-points (&#39;ocean_time&#39;, &#39;eta_rho&#39;, &#39;xi_rho&#39;)
vbar_northward --&gt; time-averaged northward vertically integrated momentum component at RHO-points (&#39;ocean_time&#39;, &#39;eta_rho&#39;, &#39;xi_rho&#39;)
u_eastward --&gt; time-averaged eastward momentum component at RHO-points (&#39;ocean_time&#39;, &#39;s_rho&#39;, &#39;eta_rho&#39;, &#39;xi_rho&#39;)
v_northward --&gt; time-averaged northward momentum component at RHO-points (&#39;ocean_time&#39;, &#39;s_rho&#39;, &#39;eta_rho&#39;, &#39;xi_rho&#39;)
temp --&gt; time-averaged potential temperature (&#39;ocean_time&#39;, &#39;s_rho&#39;, &#39;eta_rho&#39;, &#39;xi_rho&#39;)
salt --&gt; time-averaged salinity (&#39;ocean_time&#39;, &#39;s_rho&#39;, &#39;eta_rho&#39;, &#39;xi_rho&#39;)
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The dataset contains data from&quot;</span><span class="p">,</span>
      <span class="n">dset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ocean_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
      <span class="s2">&quot;to&quot;</span><span class="p">,</span>
      <span class="n">dset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ocean_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>The dataset contains data from 2017-01-01T12:00:00.000000000 to 2017-03-31T12:00:00.000000000
</code></pre></div>

<p>Now lets load some data. Lets say we want temperature data.
The corresponding variable for time-averaged potential temperature is named 'temp'
The dimensions and shape of the array are the following</p>
<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shape of &#39;temp&#39; variable is &quot;</span><span class="p">,</span> <span class="n">dset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dimensions are &quot;</span><span class="p">,</span> <span class="n">dset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Shape of &#39;temp&#39; variable is  (90, 40, 467, 397)
Dimensions are  (&#39;ocean_time&#39;, &#39;s_rho&#39;, &#39;eta_rho&#39;, &#39;xi_rho&#39;)
</code></pre></div>

<p>The variable has 4 dimension in order time/level/2 dimensions of space.
We load the data every 10 time-stamp for the level the closest to the surface (last one) and over the whole simulation domain.</p>
<div class="codehilite"><pre><span></span><code><span class="n">temp_data</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">][::</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</code></pre></div>

<p>Now lets plot the data. We plot the 6 consecutive frames in a 2x3 array.</p>
<div class="codehilite"><pre><span></span><code><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span> <span class="n">temp_data</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="../Moana_thredds_server_connector_files/Moana_thredds_server_connector_25_0.png" /></p>
<p>Now lets get a time-series of time-averaged elevation at a specific location. The corresponding variable is named zeta and has 3 dimensions (one of time and 2 of space)</p>
<div class="codehilite"><pre><span></span><code><span class="n">zeta_data</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;zeta&#39;</span><span class="p">][:,</span><span class="mi">300</span><span class="p">,</span><span class="mi">100</span><span class="p">]</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.dates</span> <span class="kn">import</span> <span class="n">date2num</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Time-averaged surface elevation (m)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot_date</span><span class="p">(</span><span class="n">date2num</span><span class="p">(</span><span class="n">dset</span><span class="o">.</span><span class="n">ocean_time</span><span class="p">),</span> <span class="n">zeta_data</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&lt;matplotlib.lines.Line2D at 0x145e92433358&gt;]
</code></pre></div>

<p><img alt="png" src="../Moana_thredds_server_connector_files/Moana_thredds_server_connector_28_1.png" /></p>
<p>More to come on how to get data for a specific bounding box or point defined using WGS84 longitudes and latitudes.
Also, more data will be uploaded to the server which will be described.</p>
<p>None lets plot a cross section of the data.
First we select a cross section of the 3D grid for the first timestamp of the dataset.</p>
<div class="codehilite"><pre><span></span><code><span class="n">ds</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">ocean_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">xi_rho</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</code></pre></div>

<p>It can be plot using the s coordinate as the vertical dimension which does not show the actual depth of the cross-section.</p>
<div class="codehilite"><pre><span></span><code><span class="n">ds</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;matplotlib.collections.QuadMesh at 0x145e91f39128&gt;
</code></pre></div>

<p><img alt="png" src="../Moana_thredds_server_connector_files/Moana_thredds_server_connector_33_1.png" /></p>
<p>Following (http://xarray.pydata.org/en/stable/examples/ROMS_ocean_model.html) we can write the equations to calculate the vertical coordinate</p>
<div class="codehilite"><pre><span></span><code><span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">Vtransform</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">Zo_rho</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">hc</span> <span class="o">*</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">s_rho</span> <span class="o">-</span> <span class="n">ds</span><span class="o">.</span><span class="n">Cs_r</span><span class="p">)</span> <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">Cs_r</span> <span class="o">*</span> <span class="n">ds</span><span class="o">.</span><span class="n">h</span>
    <span class="n">z_rho</span> <span class="o">=</span> <span class="n">Zo_rho</span> <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">zeta</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">Zo_rho</span><span class="o">/</span><span class="n">ds</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">ds</span><span class="o">.</span><span class="n">Vtransform</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">Zo_rho</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">hc</span> <span class="o">*</span> <span class="n">ds</span><span class="o">.</span><span class="n">s_rho</span> <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">Cs_r</span> <span class="o">*</span> <span class="n">ds</span><span class="o">.</span><span class="n">h</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">hc</span> <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
    <span class="n">z_rho</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">zeta</span> <span class="o">+</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">zeta</span> <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">Zo_rho</span>

<span class="n">ds</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;z_rho&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_rho</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="c1"># needing transpose seems to be an xarray bug</span>
</code></pre></div>

<p>Now the plot can be redone using the depth and the latitudes as coordinates</p>
<div class="codehilite"><pre><span></span><code><span class="n">ds</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;lat_rho&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;z_rho&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;matplotlib.collections.QuadMesh at 0x145e91e2b400&gt;
</code></pre></div>

<p><img alt="png" src="../Moana_thredds_server_connector_files/Moana_thredds_server_connector_37_1.png" /></p>
<div class="codehilite"><pre><span></span><code>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        

<!-- Application footer -->
<footer class="md-footer">

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">

      <!-- Copyright and theme information -->
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 - 2020
          </div>
        
        Made with
        <a
          href="https://squidfunk.github.io/mkdocs-material/"
          target="_blank" rel="noopener"
        >
          Material for MkDocs
        </a>
      </div>

      <!-- Social links -->
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/abifet/taiao-docs" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.6a3d08fc.min.js"></script>
      <script src="../../assets/javascripts/bundle.71201edf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ['navigation.tabs', 'navigation.instant'],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
        <script src="../../js/version-select.js"></script>
      
    
  </body>
</html>